name: test CICD Pipeline

on:
  push:
    branches: 
      - main

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Extract branch name
        shell: bash
        run: |
          echo "branch=${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}}" >> $GITHUB_ENV
        id: extract_branch

      - if: ${{ env.BRANCH == 'develop' }}
        name: Deploy to Server-DEV, Skipped if branch to the code is not develop
        uses: easingthemes/ssh-deploy@main
        env:
          REMOTE_SSH_KEY: ${{ secrets.REMOTE_SSH_KEY }}
          REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
          REMOTE_USER: ${{ secrets.REMOTE_USER }}
          SOURCE: './'
          TARGET: /root/
